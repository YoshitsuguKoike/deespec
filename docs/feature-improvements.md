# DeeSpec æ©Ÿèƒ½æ”¹å–„å€™è£œãƒªã‚¹ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ä»Šå¾Œå®Ÿè£…ã™ã¹ãæ©Ÿèƒ½æ”¹å–„ã‚’ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ã¾ã™ã€‚

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-10-10 (ULIDé †åºå•é¡Œã¨å†å®Ÿè¡Œæ©Ÿèƒ½è¿½åŠ )
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 3å®Œäº†å¾Œã€Phase 8é€²è¡Œä¸­

---

## å„ªå…ˆåº¦ã®å®šç¾©

- ğŸš¨ **Critical**: ã‚·ã‚¹ãƒ†ãƒ ã®æ­£å¸¸å‹•ä½œã«å¿…é ˆã€å³æ™‚å¯¾å¿œãŒå¿…è¦
- ğŸ”´ **High**: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã«ç›´æ¥å½±éŸ¿ã€æ—©æ€¥ã«å®Ÿè£…ã™ã¹ã
- ğŸŸ¡ **Medium**: åˆ©ä¾¿æ€§å‘ä¸Šã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…æ¤œè¨
- ğŸŸ¢ **Low**: Nice-to-haveã€ä½™è£•ãŒã‚ã‚Œã°å®Ÿè£…

---

## ğŸš¨ å„ªå…ˆåº¦: Critical

### 1. ULIDé †åºå•é¡Œã®ä¿®æ­£ã¨ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ•ãƒ­ãƒ¼å®Ÿè£…

**å„ªå…ˆåº¦**: ğŸš¨ **æœ€å„ªå…ˆ - ã‚·ã‚¹ãƒ†ãƒ ã®æ­£å¸¸å‹•ä½œã«å¿…é ˆ**

**ç¾çŠ¶ã®å•é¡Œ:**

1. **ULIDé †åºå•é¡Œ**: ULIDã®æ–‡å­—åˆ—ã‚½ãƒ¼ãƒˆã«ã‚ˆã‚Šã€ã‚¿ã‚¹ã‚¯ãŒç™»éŒ²é †ã«å®Ÿè¡Œã•ã‚Œãªã„
   - ULIDã¯å…ˆé ­48ãƒ“ãƒƒãƒˆã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€ãŒã€ãƒŸãƒªç§’å˜ä½ã§è¤‡æ•°ç™»éŒ²ã™ã‚‹ã¨é †åºãŒä¿è¨¼ã•ã‚Œãªã„
   - ãƒ©ãƒ³ãƒ€ãƒ éƒ¨åˆ†ã®å½±éŸ¿ã§ç™»éŒ²é †åºãŒå´©ã‚Œã‚‹
   - SQLiteåŒ–å‰ã‹ã‚‰å­˜åœ¨ã™ã‚‹æ—¢çŸ¥ã®å•é¡Œ

2. **å†å®Ÿè¡Œæ©Ÿèƒ½ã®æ¬ å¦‚**:
   - Claude Codeèªè¨¼å•é¡Œãªã©ã§SBIãŒèª¤ã£ã¦é€²è¡Œã—ã€review&wipã‚¹ãƒ†ãƒƒãƒ—ã§å¼·åˆ¶å®Œäº†ã—ãŸå ´åˆã«ã‚„ã‚Šç›´ã›ãªã„
   - AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå®Ÿè³ªçš„ã«ã¯å¤±æ•—ã—ã¦ã„ã‚‹ã®ã«æˆåŠŸã¨åˆ¤æ–­ã—ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹
   - ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèªã§ããªã„

3. **ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ•ãƒ­ãƒ¼ã®ä¸è¶³**:
   - ä¸€è¦§è¡¨ç¤º â†’ è©³ç´°ç¢ºèª â†’ å†å®Ÿè¡Œã¨ã„ã†åŸºæœ¬ãƒ•ãƒ­ãƒ¼ãŒå­˜åœ¨ã—ãªã„
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã™ã‚‹ã—ã‹ãªã„

**è¦ä»¶:**

- **å„ªå…ˆåº¦é †åº**: Priority (DESC) â†’ ç™»éŒ²é †åº (ASC) ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
- **ç™»éŒ²é †åºã®ä¿è¨¼**: åŒä¸€å„ªå…ˆåº¦å†…ã§ã¯å¿…ãšç™»éŒ²é †ã«å®Ÿè¡Œ
- **å†å®Ÿè¡Œå¯èƒ½æ€§**: å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã‚’ä»»æ„ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ãƒªã‚»ãƒƒãƒˆå¯èƒ½
- **å±¥æ­´è¿½è·¡**: ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèªå¯èƒ½

---

#### è§£æ±ºç­–ã®è©³ç´°

**1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®æ‹¡å¼µ**

`sbis`ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ˜ç¤ºçš„ãªé †åºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ :

```sql
-- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 006_add_ordering_fields.sql
ALTER TABLE sbis ADD COLUMN priority INTEGER DEFAULT 0;      -- å„ªå…ˆåº¦(0=é€šå¸¸, 1=é«˜, 2=ç·Šæ€¥)
ALTER TABLE sbis ADD COLUMN sequence INTEGER;                -- ç™»éŒ²é †åºç•ªå·(è‡ªå‹•æ¡ç•ª)
ALTER TABLE sbis ADD COLUMN registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;

-- æ—¢å­˜SBIã®sequenceã‚’created_atãƒ™ãƒ¼ã‚¹ã§ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«
UPDATE sbis SET sequence = (
    SELECT COUNT(*) FROM sbis AS s2 WHERE s2.created_at <= sbis.created_at
);

-- åŠ¹ç‡çš„ãªé †åºã‚¯ã‚¨ãƒªã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_sbis_ordering ON sbis(priority DESC, registered_at ASC, sequence ASC);
```

**è¨­è¨ˆã®ç†ç”±:**
- `priority`: æ˜ç¤ºçš„ãªå„ªå…ˆåº¦ç®¡ç†(0=é€šå¸¸, 1=é«˜, 2=ç·Šæ€¥ãªã©)
- `sequence`: ç™»éŒ²é †åºã‚’ä¿è¨¼ã™ã‚‹è‡ªå‹•æ¡ç•ªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- `registered_at`: ULIDã¨ã¯ç‹¬ç«‹ã—ãŸæ˜ç¤ºçš„ãªç™»éŒ²ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
- **ULIDè‡ªä½“ã¯å¤‰æ›´ã›ãš**ã€ä¸€æ„è­˜åˆ¥å­ã¨ã—ã¦ç¶™ç¶šä½¿ç”¨
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯`(priority DESC, registered_at ASC, sequence ASC)`ã§æœ€é©åŒ–

**2. Domainå±¤ã®å¤‰æ›´**

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/domain/sbi.go`

```go
type SBI struct {
    ID           string    // ULID (ä¸€æ„è­˜åˆ¥å­ã¨ã—ã¦ç¶­æŒ)
    Title        string
    Priority     int       // 0=é€šå¸¸, 1=é«˜, 2=ç·Šæ€¥
    Status       string
    Sequence     int       // ç™»éŒ²é †åº(åŒä¸€å„ªå…ˆåº¦å†…)
    RegisteredAt time.Time // æ˜ç¤ºçš„ãªç™»éŒ²ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    CreatedAt    time.Time
    UpdatedAt    time.Time
    Labels       []string
    SpecPath     string
}
```

**3. Repositoryå±¤ã®å¤‰æ›´**

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go`

```go
// ListSBIs ã¯å„ªå…ˆåº¦(DESC)â†’ç™»éŒ²é †(ASC)ã§SBIã‚’è¿”ã™
func (r *SBIRepositoryImpl) ListSBIs(ctx context.Context, filter *SBIFilter) ([]*domain.SBI, error) {
    query := `
        SELECT id, title, priority, status, registered_at, sequence, created_at, updated_at
        FROM sbis
        WHERE 1=1
    `
    args := []interface{}{}

    if filter != nil {
        if filter.Status != "" {
            query += " AND status = ?"
            args = append(args, filter.Status)
        }
        if filter.Priority >= 0 {
            query += " AND priority = ?"
            args = append(args, filter.Priority)
        }
    }

    // é‡è¦: ã“ã®é †åºã§ã‚¿ã‚¹ã‚¯å®Ÿè¡Œé †ã‚’åˆ¶å¾¡
    query += " ORDER BY priority DESC, registered_at ASC, sequence ASC"

    // ... å®Ÿè£…
}

// GetNextSequence ã¯æ¬¡ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’è¿”ã™(ä¸¦è¡Œå®‰å…¨)
func (r *SBIRepositoryImpl) GetNextSequence(ctx context.Context) (int, error) {
    query := `SELECT COALESCE(MAX(sequence), 0) + 1 FROM sbis`
    var seq int
    err := r.db.QueryRowContext(ctx, query).Scan(&seq)
    return seq, err
}

// ResetSBIState ã¯SBIã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦å†å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹
func (r *SBIRepositoryImpl) ResetSBIState(ctx context.Context, id string, toStatus string) error {
    query := `UPDATE sbis SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?`
    _, err := r.db.ExecContext(ctx, query, toStatus, id)
    return err
}

// GetSBIHistory ã¯å®Ÿè¡Œå±¥æ­´ã‚’journal.ndjsonã‹ã‚‰å–å¾—
func (r *SBIRepositoryImpl) GetSBIHistory(ctx context.Context, id string) ([]*domain.ExecutionHistory, error) {
    // journal.ndjsonã‚’èª­ã¿è¾¼ã¿ã€æŒ‡å®šIDã®å±¥æ­´ã‚’æŠ½å‡º
    // ... å®Ÿè£…
}
```

**4. Applicationå±¤ã®å¤‰æ›´**

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/application/usecase/sbi/register_sbi_usecase.go`

ç™»éŒ²æ™‚ã«sequenceã‚’è‡ªå‹•è¨­å®š:

```go
func (u *RegisterSBIUseCase) Execute(ctx context.Context, req RegisterSBIRequest) (*RegisterSBIResponse, error) {
    // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§æ¬¡ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’å–å¾—(ä¸¦è¡Œå®‰å…¨)
    sequence, err := u.sbiRepo.GetNextSequence(ctx)
    if err != nil {
        return nil, fmt.Errorf("failed to get next sequence: %w", err)
    }

    sbi := &domain.SBI{
        ID:           generateULID(),
        Title:        req.Title,
        Priority:     req.Priority,    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã€ã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0
        Sequence:     sequence,        // è‡ªå‹•æ¡ç•ª
        RegisteredAt: time.Now(),      // æ˜ç¤ºçš„ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
        Status:       "pending",
        Labels:       req.Labels,
        SpecPath:     specPath,
    }

    if err := u.sbiRepo.Save(ctx, sbi); err != nil {
        return nil, err
    }

    return &RegisterSBIResponse{SBIID: sbi.ID}, nil
}
```

**æ–°è¦UseCaseãƒ•ã‚¡ã‚¤ãƒ«**:
- `internal/application/usecase/sbi/list_sbis_usecase.go` - ä¸€è¦§å–å¾—
- `internal/application/usecase/sbi/get_sbi_detail_usecase.go` - è©³ç´°å–å¾—
- `internal/application/usecase/sbi/reset_sbi_usecase.go` - çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
- `internal/application/usecase/sbi/get_sbi_history_usecase.go` - å®Ÿè¡Œå±¥æ­´å–å¾—

**5. Pickerå±¤ã®ä¿®æ­£**

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/application/usecase/workflow/picker.go`

æ­£ã—ã„é †åºã§ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ:

```go
func (p *Picker) PickNext(ctx context.Context) (*domain.SBI, error) {
    query := `
        SELECT id, title, priority, status, sequence, registered_at
        FROM sbis
        WHERE status IN ('pending', 'in_progress')
        ORDER BY priority DESC, registered_at ASC, sequence ASC
        LIMIT 1
    `

    var sbi domain.SBI
    err := p.db.QueryRowContext(ctx, query).Scan(
        &sbi.ID, &sbi.Title, &sbi.Priority, &sbi.Status, &sbi.Sequence, &sbi.RegisteredAt,
    )

    if err == sql.ErrNoRows {
        return nil, nil // ã‚¿ã‚¹ã‚¯ãªã—
    }
    if err != nil {
        return nil, fmt.Errorf("failed to pick next SBI: %w", err)
    }

    return &sbi, nil
}
```

**è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ**:
- `ORDER BY priority DESC, registered_at ASC, sequence ASC`ã§æ­£ç¢ºãªé †åºåˆ¶å¾¡
- æœ€é«˜å„ªå…ˆåº¦ãŒæœ€åˆã€åŒä¸€å„ªå…ˆåº¦å†…ã§ã¯ç™»éŒ²é †ã‚’ä¿è¨¼
- SQLiteã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚æœ€é©åŒ–

**6. CLIå±¤ã®æ–°è¦ã‚³ãƒãƒ³ãƒ‰**

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/interface/cli/sbi/list.go` (æ–°è¦ä½œæˆ)

```go
func newListCommand() *cobra.Command {
    var (
        status   string
        priority int
        format   string
    )

    cmd := &cobra.Command{
        Use:   "list",
        Short: "ç™»éŒ²ã•ã‚ŒãŸSBIã®ä¸€è¦§ã‚’è¡¨ç¤º",
        Long:  "å„ªå…ˆåº¦(DESC)â†’ç™»éŒ²é †(ASC)ã§SBIã‚’è¡¨ç¤ºã—ã¾ã™",
        RunE: func(cmd *cobra.Command, args []string) error {
            // list usecaseã‚’å‘¼ã³å‡ºã—
            // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤º: Priority, Sequence, ID, Title, Status, Registered
            return nil
        },
    }

    cmd.Flags().StringVar(&status, "status", "", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿")
    cmd.Flags().IntVar(&priority, "priority", -1, "å„ªå…ˆåº¦ã§ãƒ•ã‚£ãƒ«ã‚¿(-1=å…¨ã¦)")
    cmd.Flags().StringVar(&format, "format", "table", "å‡ºåŠ›å½¢å¼(table, json, yaml)")

    return cmd
}
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```bash
$ deespec sbi list

Priority  Seq  UUID                                  ID       Title                    Status      Registered
--------  ---  ------------------------------------  -------  -----------------------  ----------  -------------------
2         001  a1b2c3d4-e5f6-7890-abcd-ef1234567890  SBI-003  Critical Bug Fix         pending     2025-10-10 16:10:23
1         002  e520e775-f36f-4edc-8519-19fb20449ecc  SBI-001  User Authentication      in_progress 2025-10-10 16:07:15
1         003  f6g7h8i9-j0k1-2345-lmno-pq6789012345  SBI-004  Payment Integration      pending     2025-10-10 16:12:45
0         004  b2c3d4e5-f6g7-8901-bcde-fg2345678901  SBI-002  Database Migration       pending     2025-10-10 16:09:32

4 SBIs (1 in_progress, 3 pending)
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/interface/cli/sbi/show.go` (æ–°è¦ä½œæˆ)

```go
func newShowCommand() *cobra.Command {
    cmd := &cobra.Command{
        Use:   "show <id>",
        Short: "SBIã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º",
        Args:  cobra.ExactArgs(1),
        RunE: func(cmd *cobra.Command, args []string) error {
            sbiID := args[0]
            // get detail usecaseã‚’å‘¼ã³å‡ºã—
            // è©³ç´°æƒ…å ±ã¨spec.mdã®å†…å®¹ã‚’è¡¨ç¤º
            return nil
        },
    }
    return cmd
}
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/interface/cli/sbi/reset.go` (æ–°è¦ä½œæˆ)

```go
func newResetCommand() *cobra.Command {
    var (
        toStatus string
        force    bool
    )

    cmd := &cobra.Command{
        Use:   "reset <id>",
        Short: "SBIã‚’å†å®Ÿè¡Œå¯èƒ½ãªçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ",
        Long:  "å®Œäº†æ¸ˆã¿ã®SBIã‚’æŒ‡å®šã—ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«æˆ»ã—ã€å†å®Ÿè¡Œã‚’å¯èƒ½ã«ã—ã¾ã™",
        Args:  cobra.ExactArgs(1),
        RunE: func(cmd *cobra.Command, args []string) error {
            sbiID := args[0]

            if !force {
                // ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                fmt.Printf("æœ¬å½“ã«SBI %s ã‚’ %s ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹? [y/N]: ", sbiID, toStatus)
                var response string
                fmt.Scanln(&response)
                if response != "y" && response != "Y" {
                    fmt.Println("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ")
                    return nil
                }
            }

            // reset usecaseã‚’å‘¼ã³å‡ºã—
            return nil
        },
    }

    cmd.Flags().StringVar(&toStatus, "to-status", "pending", "ãƒªã‚»ãƒƒãƒˆå…ˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹")
    cmd.Flags().BoolVar(&force, "force", false, "ç¢ºèªãªã—ã§ãƒªã‚»ãƒƒãƒˆ")

    return cmd
}
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/interface/cli/sbi/history.go` (æ–°è¦ä½œæˆ)

```go
func newHistoryCommand() *cobra.Command {
    cmd := &cobra.Command{
        Use:   "history <id>",
        Short: "SBIã®å®Ÿè¡Œå±¥æ­´ã‚’è¡¨ç¤º",
        Args:  cobra.ExactArgs(1),
        RunE: func(cmd *cobra.Command, args []string) error {
            sbiID := args[0]
            // journal.ndjsonã‹ã‚‰å±¥æ­´ã‚’å–å¾—
            // å®Ÿè¡Œè©¦è¡Œå›æ•°ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€çµæœã‚’è¡¨ç¤º
            return nil
        },
    }
    return cmd
}
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/interface/cli/sbi/sbi.go`

æ—¢å­˜ã‚³ãƒãƒ³ãƒ‰ã«ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ :

```go
func NewSBICommand() *cobra.Command {
    cmd := &cobra.Command{
        Use:   "sbi",
        Short: "Specification Backlog Item (SBI)ã®ç®¡ç†",
    }

    cmd.AddCommand(newRegisterCommand())  // æ—¢å­˜
    cmd.AddCommand(newListCommand())      // æ–°è¦
    cmd.AddCommand(newShowCommand())      // æ–°è¦
    cmd.AddCommand(newResetCommand())     // æ–°è¦
    cmd.AddCommand(newHistoryCommand())   // æ–°è¦

    return cmd
}
```

---

#### å®Ÿè£…ã®å„ªå…ˆé †ä½

**Phase 1 (å³æ™‚å¯¾å¿œ - æœ€å„ªå…ˆ):**
1. âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³(priority, sequence, registered_atè¿½åŠ )
2. âœ… SBI domainãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°
3. âœ… ç™»éŒ²usecaseã§sequenceè‡ªå‹•è¨­å®š
4. âœ… pickerã®é †åºã‚¯ã‚¨ãƒªä¿®æ­£(`ORDER BY priority DESC, registered_at ASC, sequence ASC`)
5. âœ… è¤‡æ•°SBIç™»éŒ²ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿæ–½

**Phase 2 (é«˜å„ªå…ˆåº¦):**
6. â¬œ `sbi list`ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
7. â¬œ `sbi show <id>`ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
8. â¬œ å„ç¨®å„ªå…ˆåº¦ã§ã®é †åºãƒ†ã‚¹ãƒˆ

**Phase 3 (ä¸­å„ªå…ˆåº¦):**
9. â¬œ `sbi reset <id>`ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
10. â¬œ `sbi history <id>`ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
11. â¬œ journal.ndjsoné€£æºç¢ºèª

---

#### æœŸå¾…ã•ã‚Œã‚‹çµæœ

å®Ÿè£…å¾Œ:
- âœ… SBIã¯æ­£ã—ã„é †åºã§å®Ÿè¡Œã•ã‚Œã‚‹: **å„ªå…ˆåº¦DESC â†’ ç™»éŒ²é †ASC**
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ­£ã—ã„é †åºã§SBIä¸€è¦§ã‚’ç¢ºèªå¯èƒ½
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯SBIã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªå¯èƒ½
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èª¤ã£ã¦å®Œäº†ã—ãŸSBIã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦å†å®Ÿè¡Œå¯èƒ½
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèªã—ã¦ä½•ãŒèµ·ããŸã‹ç†è§£å¯èƒ½
- âœ… Claude Codeèªè¨¼å•é¡Œãªã©ã§ã®èª¤é€²è¡Œã«å¯¾å‡¦å¯èƒ½

---

#### é–¢é€£Issue

- #N/A (æ–°è¦ä½œæˆäºˆå®š)

---

#### å®Ÿè£…å ´æ‰€ã‚µãƒãƒª

| å±¤ | ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|----|---------|----------|
| Infrastructure | `migrations/006_add_ordering_fields.sql` | ã‚¹ã‚­ãƒ¼ãƒè¿½åŠ  |
| Infrastructure | `sqlite/sbi_repository_impl.go` | ListSBIs, GetNextSequence, ResetSBIStateè¿½åŠ  |
| Domain | `domain/sbi.go` | Priority, Sequence, RegisteredAtè¿½åŠ  |
| Application | `usecase/sbi/register_sbi_usecase.go` | Sequenceè‡ªå‹•è¨­å®š |
| Application | `usecase/sbi/list_sbis_usecase.go` | æ–°è¦ä½œæˆ |
| Application | `usecase/sbi/get_sbi_detail_usecase.go` | æ–°è¦ä½œæˆ |
| Application | `usecase/sbi/reset_sbi_usecase.go` | æ–°è¦ä½œæˆ |
| Application | `usecase/workflow/picker.go` | ORDER BYä¿®æ­£ |
| Interface | `cli/sbi/list.go` | æ–°è¦ä½œæˆ |
| Interface | `cli/sbi/show.go` | æ–°è¦ä½œæˆ |
| Interface | `cli/sbi/reset.go` | æ–°è¦ä½œæˆ |
| Interface | `cli/sbi/history.go` | æ–°è¦ä½œæˆ |
| Interface | `cli/sbi/sbi.go` | ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è¿½åŠ  |

---

#### ä½œæ¥­è¨ˆç”» (Phase 1å®Ÿè£…)

**ç›®æ¨™**: ULIDé †åºå•é¡Œã‚’ä¿®æ­£ã—ã€ã‚¿ã‚¹ã‚¯ã‚’æ­£ã—ã„é †åº(å„ªå…ˆåº¦â†’ç™»éŒ²é †)ã§å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹

**æ¨å®šå·¥æ•°**: 4-6æ™‚é–“

**å‰ææ¡ä»¶**:
- SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆæœŸåŒ–æ¸ˆã¿
- æ—¢å­˜ã®SBIãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ãŒå‹•ä½œ

---

##### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ (30åˆ†)

**ä½œæ¥­å†…å®¹**:
1. `internal/infrastructure/persistence/sqlite/migrations/006_add_ordering_fields.sql` ã‚’æ–°è¦ä½œæˆ
2. ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´SQLè¨˜è¿°:
   - `ALTER TABLE sbis ADD COLUMN priority INTEGER DEFAULT 0`
   - `ALTER TABLE sbis ADD COLUMN sequence INTEGER`
   - `ALTER TABLE sbis ADD COLUMN registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`
3. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«:
   - `UPDATE sbis SET sequence = ...` (created_atãƒ™ãƒ¼ã‚¹)
4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ:
   - `CREATE INDEX idx_sbis_ordering ON sbis(priority DESC, registered_at ASC, sequence ASC)`

**ç¢ºèªæ–¹æ³•**:
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
sqlite3 test.db < internal/infrastructure/persistence/sqlite/migrations/006_add_ordering_fields.sql

# ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª
sqlite3 .deespec/deespec.db ".schema sbis"
```

**æˆæœç‰©**:
- `internal/infrastructure/persistence/sqlite/migrations/006_add_ordering_fields.sql`

---

##### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ©Ÿæ§‹ã®ç¢ºèªãƒ»æ›´æ–° (30åˆ†)

**ä½œæ¥­å†…å®¹**:
1. `internal/infrastructure/persistence/sqlite/migration.go` ã‚’ç¢ºèª
2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®ç¢ºèª
3. 006ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²
4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**ç¢ºèªæ–¹æ³•**:
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
go run cmd/deespec/main.go init

# ã¾ãŸã¯æ—¢å­˜DBã«å¯¾ã—ã¦
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ã‚³ãƒãƒ³ãƒ‰(å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å ´åˆ)
```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸ `migration.go` (å¿…è¦ã«å¿œã˜ã¦)
- å‹•ä½œç¢ºèªæ¸ˆã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

---

##### ã‚¹ãƒ†ãƒƒãƒ—3: Domainå±¤ã®æ›´æ–° (30åˆ†)

**ä½œæ¥­å†…å®¹**:
1. `internal/domain/sbi.go` ã‚’ç·¨é›†
2. `SBI` æ§‹é€ ä½“ã«ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ :
   ```go
   Priority     int       // 0=é€šå¸¸, 1=é«˜, 2=ç·Šæ€¥
   Sequence     int       // ç™»éŒ²é †åº
   RegisteredAt time.Time // ç™»éŒ²ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
   ```
3. ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ã®æ›´æ–°(å­˜åœ¨ã™ã‚‹å ´åˆ)

**ç¢ºèªæ–¹æ³•**:
```bash
# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
go build ./internal/domain/...
```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸ `internal/domain/sbi.go`

---

##### ã‚¹ãƒ†ãƒƒãƒ—4: Repositoryå±¤ã®æ›´æ–° (1.5æ™‚é–“)

**ä½œæ¥­å†…å®¹**:
1. `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go` ã‚’ç·¨é›†
2. ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ :
   - `GetNextSequence(ctx context.Context) (int, error)`
   - `ListSBIs(ctx context.Context, filter *SBIFilter) ([]*domain.SBI, error)`
   - `ResetSBIState(ctx context.Context, id string, toStatus string) error`
3. æ—¢å­˜ã®`Save`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›´æ–°ã—ã¦priority, sequence, registered_atã‚’ä¿å­˜
4. æ—¢å­˜ã®`FindByID`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›´æ–°ã—ã¦æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª­ã¿è¾¼ã¿

**ç¢ºèªæ–¹æ³•**:
```bash
# ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
go test ./internal/infrastructure/persistence/sqlite/... -v

# ã¾ãŸã¯ãƒ†ã‚¹ãƒˆã‚’æ–°è¦ä½œæˆ
```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸ `sbi_repository_impl.go`
- æ–°è¦ãƒ†ã‚¹ãƒˆ `sbi_repository_impl_test.go` (æ‹¡å¼µ)

---

##### ã‚¹ãƒ†ãƒƒãƒ—5: Applicationå±¤ã®æ›´æ–° (1æ™‚é–“)

**ä½œæ¥­å†…å®¹**:
1. `internal/application/usecase/sbi/register_sbi_usecase.go` ã‚’ç·¨é›†
2. `Execute`ãƒ¡ã‚½ãƒƒãƒ‰ã§ä»¥ä¸‹ã‚’å®Ÿè£…:
   - `GetNextSequence()`ã‚’å‘¼ã³å‡ºã—ã¦sequenceå–å¾—
   - `Priority`ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è¨­å®š(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0)
   - `RegisteredAt`ã‚’`time.Now()`ã§è¨­å®š
3. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§sequenceå–å¾—ã¨ä¿å­˜ã‚’å®Ÿè¡Œ(ä¸¦è¡Œå®‰å…¨æ€§ç¢ºä¿)

**ç¢ºèªæ–¹æ³•**:
```bash
# UseCaseãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
go test ./internal/application/usecase/sbi/... -v
```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸ `register_sbi_usecase.go`

---

##### ã‚¹ãƒ†ãƒƒãƒ—6: Pickerå±¤ã®æ›´æ–° (30åˆ†)

**ä½œæ¥­å†…å®¹**:
1. `internal/application/usecase/workflow/picker.go` ã‚’ç¢ºèª
2. ã‚¿ã‚¹ã‚¯é¸æŠã‚¯ã‚¨ãƒªã‚’ä»¥ä¸‹ã«å¤‰æ›´:
   ```sql
   SELECT id, title, priority, status, sequence, registered_at
   FROM sbis
   WHERE status IN ('pending', 'in_progress')
   ORDER BY priority DESC, registered_at ASC, sequence ASC
   LIMIT 1
   ```
3. æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(priority, sequence, registered_at)ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«Scanã‚’æ›´æ–°

**ç¢ºèªæ–¹æ³•**:
```bash
# Pickerãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
go test ./internal/application/usecase/workflow/... -v
```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸ `picker.go`

---

##### ã‚¹ãƒ†ãƒƒãƒ—7: çµ±åˆãƒ†ã‚¹ãƒˆ (1æ™‚é–“)

**ä½œæ¥­å†…å®¹**:
1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨å¾Œã®å‹•ä½œç¢ºèª
2. è¤‡æ•°SBIã‚’ç™»éŒ²ã—ã¦é †åºç¢ºèª:
   ```bash
   # å„ªå…ˆåº¦0ã®SBIç™»éŒ²
   echo "title: Task A" | deespec sbi register --stdin

   # å„ªå…ˆåº¦1ã®SBIç™»éŒ²(é«˜å„ªå…ˆåº¦)
   echo "title: Task B\npriority: 1" | deespec sbi register --stdin

   # å„ªå…ˆåº¦0ã®SBIç™»éŒ²
   echo "title: Task C" | deespec sbi register --stdin
   ```
3. SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèª:
   ```bash
   sqlite3 .deespec/deespec.db "SELECT priority, sequence, id, title FROM sbis ORDER BY priority DESC, registered_at ASC, sequence ASC"
   ```
4. æœŸå¾…çµæœ: Task B(å„ªå…ˆåº¦1) â†’ Task A(å„ªå…ˆåº¦0, seq 1) â†’ Task C(å„ªå…ˆåº¦0, seq 2) ã®é †

**ç¢ºèªæ–¹æ³•**:
```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
go test ./... -v

# ãƒ“ãƒ«ãƒ‰ã—ã¦å‹•ä½œç¢ºèª
go build -o deespec cmd/deespec/main.go
./deespec sbi register --stdin < test_sbi.md
```

**æˆæœç‰©**:
- å‹•ä½œç¢ºèªæ¸ˆã¿ã®å®Œå…¨ãªå®Ÿè£…
- ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ

---

##### ã‚¹ãƒ†ãƒƒãƒ—8: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆ (30åˆ†)

**ä½œæ¥­å†…å®¹**:
1. CHANGELOGæ›´æ–°
2. feature-improvements.md ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æ›´æ–°
3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³READMEæ›´æ–°(å­˜åœ¨ã™ã‚‹å ´åˆ)
4. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ:
   ```
   feat: fix ULID ordering issue with explicit priority and sequence fields

   - Add priority, sequence, registered_at to sbis table
   - Implement GetNextSequence() for registration order guarantee
   - Update Picker to use ORDER BY priority DESC, registered_at ASC, sequence ASC
   - Ensure tasks execute in correct order: priority first, then registration order

   Fixes: ULID lexicographic sorting causing incorrect task execution order
   Impact: Tasks now execute in intended order (priority â†’ registration)

   ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude <noreply@anthropic.com>
   ```

**æˆæœç‰©**:
- æ›´æ–°ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- Gitã‚³ãƒŸãƒƒãƒˆ

---

##### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**å•é¡Œ1: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œãªã„**
- åŸå› : ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®å•é¡Œ
- è§£æ±ºç­–: `schema_migrations`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèªã—ã€æ‰‹å‹•ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°

**å•é¡Œ2: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®sequenceãŒNULL**
- åŸå› : ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«SQLãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„
- è§£æ±ºç­–: æ‰‹å‹•ã§UPDATEæ–‡ã‚’å®Ÿè¡Œ

**å•é¡Œ3: GetNextSequence()ãŒåŒã˜å€¤ã‚’è¿”ã™(ä¸¦è¡Œå®Ÿè¡Œæ™‚)**
- åŸå› : ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã®å•é¡Œ
- è§£æ±ºç­–: SELECT FOR UPDATEã¾ãŸã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œ

**å•é¡Œ4: pickerãŒå¤ã„ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨**
- åŸå› : ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒã‚¤ãƒŠãƒª
- è§£æ±ºç­–: `go clean -cache && go build`ã§å†ãƒ“ãƒ«ãƒ‰

---

##### æˆåŠŸåŸºæº–

- âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã‚‹
- âœ… æ–°è¦SBIç™»éŒ²æ™‚ã«sequenceãŒè‡ªå‹•æ¡ç•ªã•ã‚Œã‚‹
- âœ… priorityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ­£ã—ãä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹
- âœ… PickerãŒå„ªå…ˆåº¦â†’ç™»éŒ²é †ã§ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹
- âœ… å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- âœ… è¤‡æ•°SBIç™»éŒ²ãƒ†ã‚¹ãƒˆã§æ­£ã—ã„é †åºãŒç¢ºèªã§ãã‚‹

---

##### ãƒªã‚¹ã‚¯ç®¡ç†

**ãƒªã‚¹ã‚¯1: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç ´æ**
- è»½æ¸›ç­–: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã«`.deespec/deespec.db`ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- å¯¾å¿œç­–: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ

**ãƒªã‚¹ã‚¯2: ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ **
- è»½æ¸›ç­–: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯é«˜é€Ÿ(ALTER TABLE + UPDATE)
- å¯¾å¿œç­–: ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„å ´åˆã¯æ®µéšçš„ç§»è¡Œ

**ãƒªã‚¹ã‚¯3: ä¸¦è¡Œå®Ÿè¡Œæ™‚ã®sequenceé‡è¤‡**
- è»½æ¸›ç­–: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§GetNextSequence()ã‚’å®Ÿè¡Œ
- å¯¾å¿œç­–: UNIQUEåˆ¶ç´„ã¾ãŸã¯ãƒ­ãƒƒã‚¯æ©Ÿæ§‹ã®è¿½åŠ 

---

##### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Phase 2æº–å‚™)

Phase 1å®Œäº†å¾Œã€ä»¥ä¸‹ã‚’æº–å‚™:
1. `sbi list`ã‚³ãƒãƒ³ãƒ‰ã®è¨­è¨ˆ
2. ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ±ºå®š
3. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜æ±ºå®š

---

## ğŸ”´ å„ªå…ˆåº¦: High

### 1. SBI/PBI/EPIC ä¸€è¦§è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰

**ç¾çŠ¶ã®å•é¡Œ:**
- ç™»éŒ²ã—ãŸSBI/PBI/EPICã‚’ç¢ºèªã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã—ãªã„
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ç›´æ¥æ¢ç´¢ã™ã‚‹ã—ã‹ãªã„
- ä¸€è¦§æ€§ãŒãªãã€ç®¡ç†ãŒå›°é›£

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# SBIä¸€è¦§è¡¨ç¤º
deespec sbi list
deespec sbi list --format json
deespec sbi list --format table
deespec sbi list --filter status=draft
deespec sbi list --sort created_at

# SBIè©³ç´°è¡¨ç¤º
deespec sbi show <id-or-uuid>

# PBIä¸€è¦§ï¼ˆå°†æ¥ï¼‰
deespec pbi list

# EPICä¸€è¦§ï¼ˆå°†æ¥ï¼‰
deespec epic list
```

**å®Ÿè£…æ–¹é‡:**

#### Option A: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ™ãƒ¼ã‚¹ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
- `.deespec/specs/sbi/` é…ä¸‹ã‚’ã‚¹ã‚­ãƒ£ãƒ³
- å„UUIDãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `spec.md` ã‚’è§£æ
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¦è¡¨ç¤º

**åˆ©ç‚¹:**
- å®Ÿè£…ãŒç°¡å˜
- SQLiteä¸è¦ã§å³åº§ã«å‹•ä½œ

**æ¬ ç‚¹:**
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œï¼ˆå¤§é‡ã®SBIã§é…ã„ï¼‰
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒé™å®šçš„

#### Option B: SQLiteãƒ™ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰
- `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go` ã‚’æ´»ç”¨
- SQLiteã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»ã‚¯ã‚¨ãƒª
- é«˜é€Ÿãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆ

**åˆ©ç‚¹:**
- é«˜é€Ÿãªã‚¯ã‚¨ãƒª
- è¤‡é›‘ãªæ¤œç´¢æ¡ä»¶ã«å¯¾å¿œå¯èƒ½
- Clean Architectureã«æº–æ‹ 

**æ¬ ç‚¹:**
- SQLiteã‚¹ã‚­ãƒ¼ãƒã®æ•´å‚™ãŒå¿…è¦
- ç™»éŒ²æ™‚ã«DBã¸ã®ä¿å­˜å‡¦ç†ãŒå¿…è¦

**æ¨å¥¨å®Ÿè£…é †åº:**
1. Phase 8.3: SQLiteãƒªãƒã‚¸ãƒˆãƒªã®å®Œå…¨å®Ÿè£…
2. Phase 8.4: `sbi list` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
3. Phase 8.5: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½è¿½åŠ 

**å‚è€ƒå®Ÿè£…å ´æ‰€:**
- CLI: `internal/interface/cli/sbi/list.go` (æ–°è¦ä½œæˆ)
- UseCase: `internal/application/usecase/sbi/list_sbi.go` (æ–°è¦ä½œæˆ)
- Repository: `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go` (æ—¢å­˜æ‹¡å¼µ)

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹:**

```bash
$ deespec sbi list --format table

UUID                                  ID              Title                      Status    Created
e520e775-f36f-4edc-8519-19fb20449ecc  SBI-001         User Authentication        draft     2025-10-10 16:07
a1b2c3d4-e5f6-7890-abcd-ef1234567890  SBI-002         Database Migration         in_progress 2025-10-09 14:32
...
```

**é–¢é€£Issue:**
- #N/A (æ–°è¦ä½œæˆäºˆå®š)

---

### 2. meta.yml ã®å®Œå…¨å»ƒæ­¢ã¨SQLiteã¸ã®ç§»è¡Œ

**ç¾çŠ¶:**
- `meta.yml` ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ï¼ˆPhase 3ã§å»ƒæ­¢ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹: `<uuid>/spec.md` ã®ã¿
- SQLiteãƒªãƒã‚¸ãƒˆãƒªã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€ã¾ã å®Œå…¨ç§»è¡Œã—ã¦ã„ãªã„

**ææ¡ˆã™ã‚‹æ”¹å–„:**

1. **ç™»éŒ²æ™‚ã®SQLiteä¿å­˜**
   - `register_sbi_usecase.go` ã§SQLiteã«ä¿å­˜
   - spec.mdã¨SQLiteã®ä¸¡æ–¹ã«æ›¸ãè¾¼ã¿

2. **ä¸€è¦§è¡¨ç¤ºãƒ»æ¤œç´¢ã¯SQLiteã‹ã‚‰**
   - `sbi list` ã¯SQLiteã‚’ã‚¯ã‚¨ãƒª
   - ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯èª­ã¾ãªã„

3. **spec.md ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çš„ä½ç½®ã¥ã‘**
   - äººé–“ãŒèª­ã‚ã‚‹å½¢å¼ã¨ã—ã¦ä¿æŒ
   - Gitã§ç®¡ç†ã—ã‚„ã™ã„

**ãƒ¡ãƒªãƒƒãƒˆ:**
- é«˜é€Ÿãªã‚¯ã‚¨ãƒª
- è¤‡é›‘ãªæ¤œç´¢æ¡ä»¶ã«å¯¾å¿œ
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«

**å®Ÿè£…å ´æ‰€:**
- `internal/application/usecase/register_sbi_usecase.go` - SQLiteä¿å­˜å‡¦ç†è¿½åŠ 
- `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go` - Save/Findå®Ÿè£…

---

## ğŸŸ¡ å„ªå…ˆåº¦: Medium

### 3. SBIæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
deespec sbi list --label backend --label security

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
deespec sbi list --status draft

# ã‚¿ã‚¤ãƒˆãƒ«ã§æ¤œç´¢
deespec sbi list --search "authentication"

# ä½œæˆæ—¥ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
deespec sbi list --created-after 2025-10-01

# çµ„ã¿åˆã‚ã›
deespec sbi list --label backend --status in_progress --sort created_at
```

**å®Ÿè£…æ–¹é‡:**
- SQLiteã®WHEREå¥ã¨ORDER BYã‚’æ´»ç”¨
- `SBIFilter` æ§‹é€ ä½“ã‚’æ‹¡å¼µ
- Cobraã®ãƒ•ãƒ©ã‚°ã§æ¡ä»¶ã‚’å—ã‘å–ã‚‹

**å‚è€ƒ:**
```go
type SBIFilter struct {
    Labels       []string
    Status       *string
    SearchQuery  *string
    CreatedAfter *time.Time
    CreatedBefore *time.Time
    Limit        int
    Offset       int
    SortBy       string  // "created_at", "updated_at", "title"
    SortOrder    string  // "asc", "desc"
}
```

---

### 4. SBIè©³ç´°è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# UUIDã¾ãŸã¯IDã§è©³ç´°è¡¨ç¤º
deespec sbi show e520e775-f36f-4edc-8519-19fb20449ecc
deespec sbi show SBI-001

# JSONå½¢å¼ã§å‡ºåŠ›
deespec sbi show SBI-001 --format json

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚‚è¡¨ç¤º
deespec sbi show SBI-001 --show-path
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**

```
SBI Details
===========

UUID:       e520e775-f36f-4edc-8519-19fb20449ecc
ID:         SBI-001
Title:      User Authentication
Status:     draft
Labels:     backend, security
Created:    2025-10-10 16:07:23 UTC
Updated:    2025-10-10 16:07:23 UTC
Path:       .deespec/specs/sbi/e520e775-f36f-4edc-8519-19fb20449ecc/spec.md

Description:
------------
[spec.mdã®å†…å®¹ã‚’è¡¨ç¤º]
```

**å®Ÿè£…å ´æ‰€:**
- CLI: `internal/interface/cli/sbi/show.go` (æ–°è¦ä½œæˆ)
- UseCase: `internal/application/usecase/sbi/get_sbi.go` (æ–°è¦ä½œæˆ)

---

### 5. è¨­å®šç®¡ç†ã‚³ãƒãƒ³ãƒ‰ (config)

**ç¾çŠ¶ã®å•é¡Œ:**
- è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ `.deespec/setting.json` ã‚’ç›´æ¥ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- è¨­å®šé …ç›®ã®ä¸€è¦§ã‚„èª¬æ˜ãŒåˆ†ã‹ã‚Šã«ãã„
- JSONæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯
- åˆå¿ƒè€…ã«ã¯æ•·å±…ãŒé«˜ã„

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# å…¨è¨­å®šã®è¡¨ç¤º
deespec config list
deespec config list --format json
deespec config list --format yaml

# ç‰¹å®šé …ç›®ã®å–å¾—
deespec config get timeout_sec
deespec config get max_turns

# è¨­å®šã®å¤‰æ›´
deespec config set timeout_sec 1200
deespec config set max_turns 10
deespec config set stderr_level debug

# è¨­å®šã®å‰Šé™¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ï¼‰
deespec config unset timeout_sec
deespec config reset <key>

# å…¨è¨­å®šã‚’åˆæœŸåŒ–
deespec config reset
deespec config reset --force

# è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
deespec config validate

# è¨­å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
deespec config export --output backup.json
deespec config import --input backup.json

# è¨­å®šé …ç›®ã®èª¬æ˜è¡¨ç¤º
deespec config describe timeout_sec
deespec config describe --all
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹:**

```bash
$ deespec config list

Configuration (.deespec/setting.json)
=====================================

Core Settings:
  home:           .deespec
  agent_bin:      claude
  timeout_sec:    900          (default)

Execution Limits:
  max_attempts:   3            (default)
  max_turns:      8            (default)

Logging:
  stderr_level:   info         (default)

Feature Flags:
  validate:       false        (default)
  auto_fb:        false        (default)

(default) = using default value
```

```bash
$ deespec config get timeout_sec
900

$ deespec config set timeout_sec 1200
âœ“ Configuration updated: timeout_sec = 1200

$ deespec config describe timeout_sec
timeout_sec
  Type:     integer
  Default:  900
  Range:    60 - 3600
  Description:
    Timeout for agent execution in seconds.
    If an agent does not respond within this time,
    the execution will be terminated.
```

**å®Ÿè£…æ–¹é‡:**

1. **èª­ã¿å–ã‚Šç³»ã‚³ãƒãƒ³ãƒ‰**
   - `setting.json` ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦è¡¨ç¤º
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨æ¯”è¼ƒã—ã¦ãƒãƒ¼ã‚¯è¡¨ç¤º

2. **æ›¸ãè¾¼ã¿ç³»ã‚³ãƒãƒ³ãƒ‰**
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
   - `setting.json` ã‚’æ›´æ–°
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆ`.deespec/setting.json.bak`ï¼‰

3. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
   - å‹ãƒã‚§ãƒƒã‚¯ï¼ˆæ–‡å­—åˆ—/æ•´æ•°/çœŸå½å€¤ï¼‰
   - ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆtimeout_sec: 60-3600ãªã©ï¼‰
   - åˆ—æŒ™å€¤ãƒã‚§ãƒƒã‚¯ï¼ˆstderr_level: debug|info|warn|errorï¼‰

4. **åˆæœŸåŒ–**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å¾©å…ƒ
   - æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

**ãƒ¡ãƒªãƒƒãƒˆ:**

1. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**
   - ã‚¨ãƒ‡ã‚£ã‚¿ä¸è¦ã§è¨­å®šå¤‰æ›´å¯èƒ½
   - è¨­å®šé …ç›®ã®ç™ºè¦‹ãŒå®¹æ˜“
   - ã‚¿ã‚¤ãƒã‚„æ§‹æ–‡ã‚¨ãƒ©ãƒ¼é˜²æ­¢

2. **å®‰å…¨æ€§å‘ä¸Š**
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ä¸æ­£ãªå€¤ã®é˜²æ­¢
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚‹å¾©æ—§å¯èƒ½æ€§

3. **æ¨™æº–çš„ãªCLIãƒ‘ã‚¿ãƒ¼ãƒ³**
   - `git config`, `npm config` ãªã©ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­¦ç¿’ã‚³ã‚¹ãƒˆãŒä½ã„

4. **è‡ªå‹•åŒ–å¯¾å¿œ**
   - CI/CDã§ã®è¨­å®šå¤‰æ›´ãŒå®¹æ˜“
   - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆãŒç°¡å˜

5. **æ—¢å­˜æ–¹å¼ã¨ã®å…±å­˜**
   - ãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥ç·¨é›†ã‚‚å¼•ãç¶šãå¯èƒ½
   - æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿ãªã—

**å®Ÿè£…å ´æ‰€:**
- CLI: `internal/interface/cli/config/config.go` (æ–°è¦ä½œæˆ)
- UseCase: `internal/application/usecase/config/config_manager.go` (æ–°è¦ä½œæˆ)
- Service: `internal/application/service/config_service.go` (æ–°è¦ä½œæˆ)

**è¨­å®šã‚¹ã‚­ãƒ¼ãƒå®šç¾©:**
```go
type ConfigSchema struct {
    Key          string
    Type         ConfigType  // String, Int, Bool
    Default      interface{}
    Description  string
    Validator    func(interface{}) error
}

var ConfigSchemas = []ConfigSchema{
    {
        Key:         "timeout_sec",
        Type:        ConfigTypeInt,
        Default:     900,
        Description: "Timeout for agent execution in seconds",
        Validator:   IntRange(60, 3600),
    },
    // ...
}
```

---

### 6. journal.ndjson ã®è‡ªå‹•ä½œæˆ

**ç¾çŠ¶ã®å•é¡Œ:**
- SBIç™»éŒ²æ™‚ã« `journal.ndjson` ãŒä½œæˆã•ã‚Œãªã„
- ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ãªã„å¯èƒ½æ€§

**èª¿æŸ»é …ç›®:**
1. `register_sbi_usecase.go` ã§ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ›¸ãè¾¼ã¿ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. `internal/infrastructure/transaction/register_transaction_service.go` ã®å®Ÿè£…ç¢ºèª
3. ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–ãƒ•ãƒ©ã‚°ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
```bash
# SBIç™»éŒ²å¾Œ
cat .deespec/journal.ndjson | tail -1 | jq .
{
  "ts": "2025-10-10T16:07:23.123Z",
  "step": "register",
  "decision": "DONE",
  "artifacts": [
    {
      "type": "sbi",
      "id": "SBI-001",
      "uuid": "e520e775-f36f-4edc-8519-19fb20449ecc",
      "spec_path": ".deespec/specs/sbi/e520e775-f36f-4edc-8519-19fb20449ecc"
    }
  ]
}
```

**å®Ÿè£…å ´æ‰€:**
- `internal/infrastructure/transaction/register_transaction_service.go`
- `internal/application/usecase/register_sbi_usecase.go`

---

## ğŸŸ¢ å„ªå…ˆåº¦: Low

### 7. SBIç·¨é›†ã‚³ãƒãƒ³ãƒ‰

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# ã‚¨ãƒ‡ã‚£ã‚¿ã§ç·¨é›†
deespec sbi edit SBI-001

# ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
deespec sbi update SBI-001 --title "New Title"

# ãƒ©ãƒ™ãƒ«è¿½åŠ 
deespec sbi update SBI-001 --add-label new-label

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
deespec sbi update SBI-001 --status in_progress
```

---

### 8. SBIå‰Šé™¤ã‚³ãƒãƒ³ãƒ‰

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# SBIå‰Šé™¤
deespec sbi delete SBI-001

# ç¢ºèªãªã—å‰Šé™¤
deespec sbi delete SBI-001 --force

# è¤‡æ•°å‰Šé™¤
deespec sbi delete SBI-001 SBI-002 SBI-003
```

**å®Ÿè£…æ–¹é‡:**
- SQLiteã‹ã‚‰å‰Šé™¤
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ `.deespec/archive/` ã«ç§»å‹•ï¼ˆå®Œå…¨å‰Šé™¤ã§ã¯ãªã„ï¼‰

---

### 9. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½

**ææ¡ˆã™ã‚‹æ©Ÿèƒ½:**

```bash
# JSONå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
deespec sbi export --output sbi-backup.json

# CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
deespec sbi export --format csv --output sbi-list.csv

# ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
deespec sbi import --input sbi-backup.json
```

**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹:**
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢
- ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ç§»è¡Œ
- Excel/Google Sheetsã§ã®ç®¡ç†

---

### 10. ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å……å®ŸåŒ–

**ç¾çŠ¶:**
```bash
$ deespec version
deespec version dev
  Go version:    go1.23.0
  OS/Arch:       darwin/arm64
  Compiler:      gc
```

**ææ¡ˆã™ã‚‹è¿½åŠ æƒ…å ±:**

```bash
$ deespec version --verbose
deespec version v1.0.0
  Build Date:    2025-10-10 16:00:00 UTC
  Git Commit:    a00cffe
  Git Branch:    main
  Go version:    go1.23.0
  OS/Arch:       darwin/arm64
  Compiler:      gc

Database:
  SQLite:        enabled
  Schema:        v1.2.0

Features:
  Label System:  enabled
  Lock System:   SQLite-based
  Journal:       enabled
```

**å®Ÿè£…æ–¹é‡:**
- buildæ™‚ã« `-ldflags` ã§åŸ‹ã‚è¾¼ã¿
- `internal/buildinfo/version.go` ã«è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

---

## å®Ÿè£…ã®é€²ã‚æ–¹

### Phase 8.3: SBIç®¡ç†æ©Ÿèƒ½ï¼ˆæ¨å¥¨ï¼‰

```bash
# å®Ÿè£…é †åº
1. SQLiteãƒªãƒã‚¸ãƒˆãƒªã®å®Œå…¨å®Ÿè£…
   - Save, Find, List, Delete ãƒ¡ã‚½ãƒƒãƒ‰
   - ãƒ†ã‚¹ãƒˆè¿½åŠ 

2. sbi list ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
   - CLI: sbi/list.go
   - UseCase: sbi/list_sbi.go
   - åŸºæœ¬çš„ãªä¸€è¦§è¡¨ç¤º

3. sbi show ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
   - CLI: sbi/show.go
   - UseCase: sbi/get_sbi.go
   - è©³ç´°è¡¨ç¤º

4. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½è¿½åŠ 
   - --label, --status, --search ãƒ•ãƒ©ã‚°
   - SQLiteã‚¯ã‚¨ãƒªæ‹¡å¼µ

5. ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ©Ÿèƒ½ã®ä¿®æ­£
   - registeræ™‚ã®journal.ndjsonæ›¸ãè¾¼ã¿ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£
```

### Phase 9: é«˜åº¦ãªç®¡ç†æ©Ÿèƒ½

```bash
1. sbi update ã‚³ãƒãƒ³ãƒ‰
2. sbi delete ã‚³ãƒãƒ³ãƒ‰
3. export/importæ©Ÿèƒ½
4. ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å……å®ŸåŒ–
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Clean Architectureè¨­è¨ˆ](./architecture/clean-architecture-design.md)
- [ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»](./architecture/refactoring-plan.md)
- [SQLiteç§»è¡Œæˆ¦ç•¥](./architecture/sqlite-migration-strategy.md)
- [CLIå±¤ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é¡](./architecture/cli-files-classification.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | æ‹…å½“ |
|------|---------|------|
| 2025-10-10 | åˆç‰ˆä½œæˆï¼ˆPhase 3å®Œäº†å¾Œï¼‰ | Claude |

---

## ğŸ“‹ å®Ÿè£…ä½œæ¥­ä¸€è¦§ã¨é€²æ—è¡¨

### Phase 1: ULIDé †åºå•é¡Œã®ä¿®æ­£ (å„ªå…ˆåº¦: ğŸš¨ Critical)

| ã‚¹ãƒ†ãƒƒãƒ— | ä½œæ¥­å†…å®¹ | å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Œäº†æ—¥ |
|---------|---------|-------------|-----------|--------|
| **ã‚¹ãƒ†ãƒƒãƒ—1** | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ | `internal/infrastructure/persistence/sqlite/schema.sql`<br>`internal/infrastructure/persistence/sqlite/migrations/004_add_ordering_fields.sql` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—2** | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ©Ÿæ§‹ã®ç¢ºèªãƒ»æ›´æ–° | `internal/infrastructure/persistence/sqlite/migration.go`<br>`internal/infrastructure/persistence/sqlite/migration_test.go` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—3** | Domainå±¤ã®æ›´æ–° | `internal/domain/model/sbi/sbi.go` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—4** | Repositoryå±¤ã®æ›´æ–° | `internal/infrastructure/persistence/sqlite/sbi_repository_impl.go`<br>`internal/domain/repository/sbi_repository.go` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—5** | Applicationå±¤ã®æ›´æ–° | `internal/application/usecase/task/task_use_case_impl.go`<br>`internal/infrastructure/transaction/register_transaction_service.go` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—6** | Pickerå±¤ã®æ›´æ–° | `internal/application/service/task_picker_service.go`<br>`internal/application/dto/sbi_task_dto.go`<br>`internal/application/dto/task_dto.go` | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—7** | çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å‹•ä½œç¢ºèª | å‹•ä½œç¢ºèªãƒ»ãƒ†ã‚¹ãƒˆå®Ÿæ–½ | âœ… å®Œäº† | 2025-10-10 |
| **ã‚¹ãƒ†ãƒƒãƒ—8** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆ | `CHANGELOG.md`<br>`docs/feature-improvements.md` | âœ… å®Œäº† | 2025-10-10 |

### Phase 2: ã‚¿ã‚¹ã‚¯ç®¡ç†CLIã‚³ãƒãƒ³ãƒ‰å®Ÿè£… (å„ªå…ˆåº¦: ğŸ”´ High)

| ã‚¹ãƒ†ãƒƒãƒ— | ä½œæ¥­å†…å®¹ | å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Œäº†æ—¥ |
|---------|---------|-------------|-----------|--------|
| **CLI-1** | `sbi list` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… | `internal/interface/cli/sbi/sbi_list.go`<br>UseCaseè¿½åŠ  | âœ… å®Œäº† | 2025-10-10 |
| **CLI-2** | `sbi show <id>` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… | `internal/interface/cli/sbi/sbi_show.go`<br>UseCaseè¿½åŠ  | âœ… å®Œäº† | 2025-10-10 |
| **CLI-3** | `sbi reset <id>` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… | `internal/interface/cli/sbi/sbi_reset.go`<br>ResetSBIState UseCase | âœ… å®Œäº† | 2025-10-10 |
| **CLI-4** | `sbi history <id>` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… | `internal/interface/cli/sbi/sbi_history.go`<br>journal.ndjsoné€£æº | âœ… å®Œäº† | 2025-10-10 |
| **CLI-5** | å„ç¨®å„ªå…ˆåº¦ã§ã®é †åºãƒ†ã‚¹ãƒˆ | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ  | â¬œ æœªå®Ÿæ–½ | - |

### å®Ÿè£…è©³ç´°ã¨æˆæœç‰©

#### Phase 1 å®Œäº†å†…å®¹

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ**
- âœ… `schema.sql`: `sequence INTEGER`, `registered_at DATETIME` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- âœ… `004_add_ordering_fields.sql`: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨å¢—åˆ†ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… `idx_sbis_ordering` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ

**ã‚¹ãƒ†ãƒƒãƒ—2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ©Ÿæ§‹**
- âœ… `migration.go`: `applyIncrementalMigrations()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
- âœ… `migration_test.go`: æ–°è¦DBãƒ»æ—¢å­˜DBã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆè¿½åŠ 
- âœ… Version 4ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ç¢ºèª

**ã‚¹ãƒ†ãƒƒãƒ—3: Domainå±¤ã®æ›´æ–°**
- âœ… `SBIMetadata` æ§‹é€ ä½“ã« `Sequence int`, `RegisteredAt time.Time` è¿½åŠ 
- âœ… ã‚¢ã‚¯ã‚»ã‚µãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ : `SetSequence()`, `Sequence()`, `SetRegisteredAt()`, `RegisteredAt()`

**ã‚¹ãƒ†ãƒƒãƒ—4: Repositoryå±¤ã®æ›´æ–°**
- âœ… SELECTæ–‡ã«sequence, registered_atè¿½åŠ 
- âœ… ORDER BYå¥ä¿®æ­£: `priority DESC, registered_at ASC, sequence ASC`
- âœ… `GetNextSequence(ctx) (int, error)` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- âœ… `ResetSBIState(ctx, id, toStatus)` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- âœ… Repository interfaceæ›´æ–°

**ã‚¹ãƒ†ãƒƒãƒ—5: Applicationå±¤ã®æ›´æ–°**
- âœ… `CreateSBI()` å†…ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…sequenceå–å¾—ãƒ»è¨­å®š
- âœ… `RegisterTransactionService` ã«DBæ¥ç¶šè¿½åŠ ï¼ˆæœªä½¿ç”¨ã€å°†æ¥ç”¨ï¼‰
- âœ… Statuså‹å¤‰æ›é–¢æ•°ä¿®æ­£

**ã‚¹ãƒ†ãƒƒãƒ—6: Pickerå±¤ã®æ›´æ–°**
- âœ… `sortTasksByPriority()` ã§priority DESCå®Ÿè£…
- âœ… registered_at, sequenceæ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
- âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆorderByæ›´æ–°: `["priority", "registered_at", "sequence", "id"]`
- âœ… SBITaskDTO, SBIDTOã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

**ã‚¹ãƒ†ãƒƒãƒ—7: çµ±åˆãƒ†ã‚¹ãƒˆ**
- âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- âœ… 3ã¤ã®SBIç™»éŒ²æˆåŠŸ (sequence: 1, 2, 3)
- âœ… å„ªå…ˆåº¦åˆ¥ã‚½ãƒ¼ãƒˆå‹•ä½œç¢ºèª (Task B[pri=1] â†’ Task A[pri=0,seq=1] â†’ Task C[pri=0,seq=3])
- âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆç¢ºèª
- âœ… Migration Version 4é©ç”¨ç¢ºèª

### æˆåŠŸåŸºæº–ã®é”æˆçŠ¶æ³

**Phase 1 æˆåŠŸåŸºæº–**:
- âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã‚‹
- âœ… æ–°è¦SBIç™»éŒ²æ™‚ã«sequenceãŒè‡ªå‹•æ¡ç•ªã•ã‚Œã‚‹ (1â†’2â†’3 ç¢ºèªæ¸ˆã¿)
- âœ… priorityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ­£ã—ãä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹
- âœ… PickerãŒå„ªå…ˆåº¦â†’ç™»éŒ²é †ã§ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹
- âœ… å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- âœ… è¤‡æ•°SBIç™»éŒ²ãƒ†ã‚¹ãƒˆã§æ­£ã—ã„é †åºãŒç¢ºèªã§ãã‚‹

**å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ (SQLiteã‚¯ã‚¨ãƒªçµæœ)**:
```
id                                   | title              | priority | seq | registered_at
-------------------------------------|--------------------|---------|----|---------------------------
8c5297dc-343d-40ea-ada4-a02b12e1043d | Task B - Priority 1|    1    | 2  | 2025-10-10 17:45:49+09:00
010b1f9c-2cbf-40e6-90d8-ecba5b62d335 | Task A - Priority 0|    0    | 1  | 2025-10-10 17:45:29+09:00
0464398f-4021-4aad-8f24-c07bde4d04b1 | Task C - Priority 0|    0    | 3  | 2025-10-10 17:45:59+09:00
```

### æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã‚¹ãƒ†ãƒƒãƒ—**:
1. **ã‚¹ãƒ†ãƒƒãƒ—8å®Ÿæ–½**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆä½œæˆ
   - CHANGELOG.md æ›´æ–°
   - feature-improvements.md ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æ›´æ–°
   - Git commitä½œæˆ

2. **Phase 2é–‹å§‹**: CLIã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
   - `sbi list` ã‹ã‚‰é–‹å§‹æ¨å¥¨
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç›´æ„Ÿçš„ã«ã‚¿ã‚¹ã‚¯ç®¡ç†ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ§‹ç¯‰

---

## ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

æ©Ÿèƒ½æ”¹å–„ã®ææ¡ˆã‚„å„ªå…ˆåº¦ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
